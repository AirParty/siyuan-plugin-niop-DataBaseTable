/*!
 * MIT License
 *
 * Copyright (c) 2023 SiYuan 思源笔记
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */(()=>{"use strict";var C={};C.d=(t,e)=>{for(var o in e)C.o(e,o)&&!C.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},C.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),C.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var O={};C.r(O),C.d(O,{NiopTable:()=>$,default:()=>k});const A=require("siyuan");var N=(t,e,o)=>new Promise((s,n)=>{var i=a=>{try{r(o.next(a))}catch(c){n(c)}},l=a=>{try{r(o.throw(a))}catch(c){n(c)}},r=a=>a.done?s(a.value):Promise.resolve(a.value).then(i,l);r((o=o.apply(t,e)).next())});class Z{constructor(){this.creatCommands=e=>{e.protyleSlash.push({filter:[],html:'<div class="b3-list-item__first"><svg class="b3-menu__icon " style=""><use xlink:href="#iconTable"></use></svg><span class="b3-list-item__text">'+e.i18n.niopimportTool+'</span><span class="b3-list-item__meta">TABLE</span></div>',id:"niop-getCommand-AVdebugDialog",callback:o=>N(this,null,function*(){console.log(`${e.i18n.DataBaseImportToolDes}`+o.protyle.notebookId);const s=o.protyle.breadcrumb.id;o.insert("<span></span>");const n=new A.Dialog({title:`${e.i18n.DataBaseImportToolDes}`,content:`
                        <div class="b3-dialog__content">
                        <div class="fn__hr"></div>
                        <div>DataBae ID:</div>
                        <div class="fn__hr"></div>
                        <input type="text" id = "niopIDBox1">
                        <div class="fn__hr"></div>
                        <div>Table ID:</div>
                        <div class="fn__hr"></div>
                        <input type="text" id = "niopIDBox2">
                        <div class="fn__hr"></div>
                        <div style="display:none">RenderMethod:</div>
                        <div class="fn__hr"></div>
                        <div class="renderMethod">
                          <button class="niopRenderSelect" id = "niopButton5" style="display: inline-block;"></button>
                        </div>
                        <div class="fn__hr"></div>
                        <div class="fn__hr"></div>
                        <div style="display:none">json:</div>
                        <div id = "jsonstring" style="display:none"></div>
                        </div>        
                    `,width:"360px",height:"440px",destroyCallback:()=>{e.saveData("niopTID_AVID",i.value),e.saveData("niopTID_TableID",l.value)}}),i=n.element.querySelector("#niopIDBox1"),l=n.element.querySelector("#niopIDBox2"),r=n.element.querySelector("#niopButton5");r.textContent=e.i18n.import,e.loadData("niopTID_AVID").then(a=>{i.value=a}),e.loadData("niopTID_TableID").then(a=>{l.value=a}),r.addEventListener("click",()=>{ie(i.value,l.value,o)})})})}}}function ee(t,e=null){(0,A.fetchPost)("/api/block/getBlockKramdown",{id:t},o=>{e&&e(o)})}function ye(t,e=null){fetchPost("/api/block/getBlockDOM",{id:t},o=>{e&&e(o)})}function H(t,e,o=null){(0,A.fetchPost)("/api/av/renderAttributeView",{id:t,pageSize:e},s=>{o&&o(s)})}const te=(t,e=null)=>{(0,A.fetchPost)("/api/block/getBlockKramdown",{id:t},o=>{const s=o.data.kramdown,n=/data-av-id="([^"]+)"/,i=s.match(n);if(!i){console.log("No av-id"),e&&e({result:!1,value:""});return}e&&e({result:!0,value:i[1]})})};function oe(){return globalThis.Lute.NewNodeID()}const ke=(t,e,o=null)=>{const s=t.id,n=[oe()];let i="";t.view.rows.length>0&&(i=t.view.rows[t.view.rows.length-1].id);const l=[{action:"insertAttrViewBlock",avID:s,previousID:i,srcIDs:n,isDetached:!0}];console.log(`ac:${s} \u65B0id:${n} \u524D\u4E00\u7EA7id${i}  do:`),e.protyle.getInstance().transaction(l,[{action:"removeAttrViewBlock",srcIDs:n,avID:s}]),o&&o(1)},Ae=(t,e)=>{const s=t.protyle.contentElement.querySelector(".protyle-title.protyle-wysiwyg--attr").getAttribute("data-node-id"),n=t.protyle.notebookId;fetchPost("/api/filetree/getHPathByID",{id:s},i=>{const l=i.data+"/\u65B0\u5EFA\u6587\u68631";fetchPost("/api/filetree/createDocWithMd",{notebook:n,path:l,markdown:"tttt"},r=>{const a=t.protyle;setTimeout(()=>{a.getInstance().transaction([{action:"insertAttrViewBlock",avID:e.id,previousID:e.view.rows[e.view.rows.length-1].id,srcIDs:[r.data],isDetached:!1}],[{action:"removeAttrViewBlock",srcIDs:[r.data],avID:e.id}])},500)})})},se=(t,e,o,s,n,i=null)=>{let l=null;n.checkerResult.result&&(l=n.checkerResult.value,(0,A.fetchPost)("/api/av/setAttributeViewBlockAttr",{avID:t,keyID:e,rowID:o,cellID:s,value:l},r=>{i&&i(r)}))};function ne(t,e){const o=/\[([^\]]*)\]\(([^)]+)\)/,s=[];let n=0,i;for(;(i=o.exec(t))!=null;){n+=1;let l=i[1];l||(l="");const r=i[2],a=t[i.index-1]==="!",c={content:r,type:a?"image":"file",name:l};t=t.replace(a?"!"+i[0]:i[0],""),s.push(c)}return n===0?{result:!1}:{result:!0,value:{[e]:s}}}const ie=(t,e,o)=>N(void 0,null,function*(){te(t,s=>{s.result&&H(s.value,2e4,n=>{ee(e,i=>N(void 0,null,function*(){if(i.code=="0"){let l=!1;const r=d=>N(void 0,null,function*(){l||(l=!0,(0,A.fetchPost)("/api/notification/pushMsg",{msg:d,data:30}),yield new Promise(b=>setTimeout(b,300)),l=!1)}),a=new ce(i.data.kramdown);if(a.duplicatesRow){console.log(a.keyWorlds),(0,A.fetchPost)("/api/notification/pushErrMsg",{msg:`table have duplicates name ${Object.keys(a.keyWorlds).filter(d=>a.keyWorlds[d]>1).join(" ")}`,data:1e3});return}let c=new K(n.data.view);if(c.duplicatesRow){(0,A.fetchPost)("/api/notification/pushErrMsg",{msg:"database have duplicates name",data:1e3});return}if(n.data.view.filters.length>0){(0,A.fetchPost)("/api/notification/pushErrMsg",{msg:"table have filters,must have none filters avaliable",data:1e3});return}const p=[],u=[],h=[],g=[],v=n.data.view.rows.length;if(a.cells[0].forEach((d,b)=>{c.columnIndexMap[d.content]!=null&&d.content!=""&&b!=0&&p.push({col:b,name:d.content})}),p.length===0)return;for(let d=1;d<a.cells.length;d++){const b={name:a.cells[d][0].content,row:d},y=c.getCellData(b.name);h.push(b),y.result||u.push(b)}let f=!0,m=0;const D=o.protyle.contentElement.querySelector(".protyle-title.protyle-wysiwyg--attr").getAttribute("data-node-id"),_=o.protyle.notebookId,w=n.data,I=[];if(u.length>0){m=u.length;let d=0;console.log("creat new note "+u.length);const b=new Date,y=`import${b.getFullYear()}_${b.getMonth()}_${b.getDay()}_${b.getHours()}_${b.getMinutes()}`;for((0,A.fetchPost)("/api/filetree/getHPathByID",{id:D},T=>N(void 0,null,function*(){(0,A.fetchPost)("/api/filetree/createDocWithMd",{notebook:_,path:T.data+"/"+y,markdown:`import at ${b.getDate()}`},Pe=>N(void 0,null,function*(){for(const Q of u){d++;const we=T.data+"/"+y+"/"+Q.name;for(console.log("creat new note "+Q.name),(0,A.fetchPost)("/api/filetree/createDocWithMd",{notebook:_,path:we,markdown:""},J=>{I.push(J.data),m--,d--});d>0;)yield new Promise(J=>setTimeout(J,10))}}))}));m>0;)yield new Promise(T=>setTimeout(T,200)),r("wait for creat note "+m);r("note creat over "+u.length)}if(yield new Promise(d=>setTimeout(d,250)),I.length>0){const d=o.protyle,b=w.view.rows.length>0?w.view.rows[w.view.rows.length-1].id:"";d.getInstance().transaction([{action:"insertAttrViewBlock",avID:w.id,previousID:b,srcIDs:I,isDetached:!1}],[{action:"removeAttrViewBlock",srcIDs:I,avID:w.id}]),yield new Promise(T=>setTimeout(T,1500)),f=!0;let y=n;for(H(s.value,v+I.length,T=>{y=T,f=!1});f;)yield new Promise(T=>setTimeout(T,200)),r("wait for av reload"+m);yield new Promise(T=>setTimeout(T,200)),console.log(y),n=y}m=p.length*h.length,c=new K(n.data.view);for(const d of p)for(const b of h){const y=c.getCellData(b.name,d.name,a.cells[b.row][d.col].content);y.result&&(y.reX=b.row,y.reY=d.col,y.content=a.cells[b.row][d.col].content,g.push(y))}yield new Promise(d=>setTimeout(d,200)),m=0;let S=0;for(let d=0;d<g.length;d++){m++,r("UPDATE "+d+" / "+g.length);const b=g[d];for(b.checkerResult.result?(se(s.value,b.value.keyID,b.rowsID,b.value.id,b,()=>{m--}),S++):m--;m>0;)yield new Promise(y=>setTimeout(y,2))}(0,A.fetchPost)("/api/notification/pushMsg",{msg:"Import Over with"+S+" data",data:1e3})}}))})})});class K{constructor(e){this.duplicatesRow=!1,this.lateKeyName="",this.laterowIndex=0,this.data=e,this.preprocessData()}preprocessData(){const e=this.data.columns.find(o=>o.type==="block");this.keyColumnIndex=this.data.columns.indexOf(e),this.columnIndexMap={},this.rowValueChecker={},this.data.columns.forEach((o,s)=>{this.columnIndexMap[o.name]=s,this.rowValueChecker[s]=le(o)}),this.rowIndexMap={},this.data.rows.forEach((o,s)=>{const n=o.cells[this.keyColumnIndex].value.block.content;n!=""&&(this.rowIndexMap[n]&&(console.log("block name duplicate "+n),this.duplicatesRow=!0),this.rowIndexMap[n]=s)})}getCellData(e,o="",s=""){if(e!=this.lateKeyName){if(this.laterowIndex=this.rowIndexMap[e],this.laterowIndex===void 0)return{result:!1};this.lateKeyName=e}if(o=="")return{result:!0};const n=this.columnIndexMap[o];if(n===void 0)return{result:!1};const i=this.data.rows[this.laterowIndex],l=i.cells[n],r=this.rowValueChecker[n],a=r(s,l.value,l.valueType);return{result:!0,value:l.value,checkerResult:a,column:this.data.columns[n],rowsID:i.id,keyName:e,columnName:o}}}const le=t=>{const e={};let o=M;switch(t.type){case"text":return B;case"date":return M;case"number":return ae;case"relation":return M;case"rollup":return M;case"select":if(!t.options)return(s,n,i)=>({result:!1,faliResult:t.name+" No Any Options"});return t.options.forEach(s=>{e[s.name]=s}),o=(s,n,i)=>{const l=e[s];let r=!1,a="",c="";if(!l)return a="input isnot in select options",{result:r,faliResult:a};const p=n.mSelect;if(p&&s==p[0].content)return a="the same as input",{result:r,faliResult:a};const u={mSelect:[{content:l.name,color:l.color}]};return c=`[${s}] -> [${p}]`,r=!0,{result:r,value:u,successLog:c}},o;break;case"block":return M;case"mSelect":if(!t.options)return(s,n,i)=>({result:!1,faliResult:t.name+" No Any Options"});return t.options.forEach(s=>{e[s.name]=s}),o=(s,n,i)=>{let l=!1,r="",a="",c="",p="";const u=[];let h=s.split(",");h||(h=[s]);const g=n.mSelect;for(let f=0;f<h.length;f++){const m=h[f],E=e[m];if(!E){c+=m+",";continue}let D=!1;if(g){for(let _=0;_<g.length;_++)if(g[_].content==m){D=!0;break}}if(D){p+=m+",";continue}u.push({content:E.name,color:E.color})}if(u.length<1)return r=`unKnow option:(${c}) duplicate option:(${p})`,{result:l,faliResult:r};let v;return g?v={mSelect:[...n.mSelect,...u]}:v={mSelect:u},a=`[${s}] -> [${g}]`,l=!0,{result:l,value:v,successLog:a}},o;break;case"url":return B;case"email":return B;case"phone":return B;case"mAsset":return re;default:return M}},B=(t,e,o)=>{const s=e[o].content;let n=!1,i="",l="";if(t==s)return i=`the same as input (${s})`,{result:n,faliResult:i};const r={[o]:{content:t}};return l=`[${t}] -> [${s}]`,n=!0,{result:n,value:r,successLog:l}},ae=(t,e,o)=>{const s=e.number.content;let n=!1,i="",l="";if(parseFloat(t)==s)return i=`the same as input (${s})`,{result:n,faliResult:i};const r={number:{content:parseFloat(t)}};return l=`[${t}] -> [${s}]`,n=!0,{result:n,value:r,successLog:l}},M=(t,e,o)=>({result:!1,faliResult:`Unkonw type [${o}] value [${t}]`}),re=(t,e,o)=>{const s=ne(t,o);let n=!1,i="",l="";if(!s.result)return i=`input isnot asset (${t})`,{result:n,faliResult:i};const r=s.value[o];let a=[],c=[];if(e.mAsset){if(a=r.filter(p=>!e.mAsset.some(h=>h.content===p.content)),a.length===0)return i=`${t} -> already in database `,{result:n,faliResult:i};l+=`asset ${a.length} ${a.map(p=>p.content).join(" ")} -> ${e.mAsset?e.mAsset.length:"none"}`,e.mAsset&&e.mAsset.length>0&&(a=[...e.mAsset,...a]),s.value=a}return c=s.value,n=!0,{result:n,value:c,successLog:l}};class ce{constructor(e){this.cells=[],this.end="",this.duplicatesRow=!1,this.keyWorlds={},this.kmdCellRegex=/{:\s*(.+?)\s*}/,this.kmdCell=o=>{const s=o.match(this.kmdCellRegex);return s?{content:o.replace(s[0],"")}:{content:o}},this.parseTable(e)}parseTable(e){const o=e.split(`
`);this.end=o[o.length-1],o.slice(0,-1).map(n=>n.split(new RegExp("(?<!\\\\)\\|")).map(i=>i.replace(/\\\|/g,"|"))).forEach((n,i)=>{this.cells[i]=[],n.forEach((l,r)=>{this.cells[i][r]=this.kmdCell(l)}),this.cells[i]=this.cells[i].slice(1,-1),this.cells[i][0].content=this.sanitizeFileName(this.cells[i][0].content),this.keyWorlds[this.cells[i][0].content]?(this.keyWorlds[this.cells[i][0].content]+=1,this.duplicatesRow=!0):this.keyWorlds[this.cells[i][0].content]=1}),this.cells=this.cells.slice(0,1).concat(this.cells.slice(2))}sanitizeFileName(e){const o=/[\/\\\?%\*:|"<>]/g;return e.replace(o,"").replace(/<br\/>/g,"")}}function De(t,e,o=null){fetchPost("/api/notification/pushMsg",{msg:t,data:e},s=>{o&&o(s)})}function Ie(t,e,o=null){fetchPost("/api/notification/pushErrMsg",{msg:t,data:e},s=>{o&&o(s)})}var R=(t,e,o)=>new Promise((s,n)=>{var i=a=>{try{r(o.next(a))}catch(c){n(c)}},l=a=>{try{r(o.throw(a))}catch(c){n(c)}},r=a=>a.done?s(a.value):Promise.resolve(a.value).then(i,l);r((o=o.apply(t,e)).next())});const W=!1,F="menu-config",Ee="custom_tab",Se="dock_tab",V=class extends A.Plugin{onload(){this.eventBus.on("switch-protyle",this.switch_protyle),V.Ini=this,this.eventBus.on("click-blockicon",this.blockIconEvent.bind(this)),this.protyleSlash=[{filter:["table","data table","database table","niop","\u8868\u683C","\u6570\u636E\u8868\u683C","\u6570\u636E\u5E93\u8868\u683C","shujubiaoge"],html:`<div class="b3-list-item__first"><svg class="b3-menu__icon " style=""><use xlink:href="#iconTable"></use></svg><span class="b3-list-item__text">${this.i18n.dTable}</span><span class="b3-list-item__meta">TABLE</span></div>`,id:"creatniopDateTable",callback(l){return R(this,null,function*(){const r=l.protyle.breadcrumb.id,a=l.protyle.contentElement.querySelector(`[data-node-id="${r}"]`),c=l.protyle.transactionTime;yield(u=>R(this,null,function*(){l.insert("<span></span>"),yield X(r),L(a,r,l.protyle,200)}))(1)})}}];const t=document.createElement("div");t.innerHTML=`
<!-- \u9009\u62E9\u6846 \u6253\u5F00\u8F85\u52A9\u5DE5\u5177 -->
<select id="niopSelect" >
    <option value="close">${V.Ini.i18n.close}</option>
    <option value="open">${V.Ini.i18n.open}</option>
</select>

<!-- \u9009\u62E9\u6846\u548C\u8F93\u5165\u6846 \u9884\u5B9A\u4E49 CSS -->
<div id="niopContainer" class="fn__none">
    <select id="niopSelect2">
        <option value="option1">\u4F7F\u7528\u5185\u5D4Ccss</option>
        <option value="option2">\u4F7F\u7528\u81EA\u5B9A\u4E49css</option>
    </select>
    <button onclick="console.log('Clicked!')">\u6062\u590D\u9ED8\u8BA4css</button>
    <input type="text" id="niopInput" placeholder="Type something...">
</div>    
<!-- \u9009\u62E9\u6846 \u6253\u5F00\u5FEB\u901F\u5DE5\u5177\u680F \u8F93\u51FA log -->
<select id="niopSelect3" class="fn__none">
    <option value="option1">Option 1</option>
    <option value="option2">Option 2</option>
    <option value="option3">Option 3</option>
</select>
<!-- \u5FEB\u901F\u5DE5\u5177\u680F -->
<div id="niopToolbar" class="fn__none">
    <button onclick="console.log('Clicked!')">Log</button>
</div>
    `;const e=t.querySelector("#niopSelect"),o=t.querySelector("#niopSelect2"),s=t.querySelector("#niopInput"),n=t.querySelector("#niopSelect3"),i=t.querySelector("#niopToolbar");this.setting=new A.Setting({confirmCallback:()=>{this.saveData(F,{useAdvanceTools:e.value})}}),this.setting.addItem({title:`${V.Ini.i18n.useImportToll}`,createActionElement:()=>(this.loadData(F).then(l=>{l.useAdvanceTools&&(e.value=l.useAdvanceTools)}),t)}),console.log("DatabaseTable from niop ~"),this.loadData(F).then(l=>{l.useAdvanceTools&&new Z().creatCommands(this)})}onLayoutReady(){}onunload(){this.eventBus.off("switch-protyle",this.switch_protyle),this.eventBus.off("click-blockicon",this.blockIconEvent.bind(this))}EventMenu(){}blockIconEvent({detail:t}){t.menu.addItem({iconHTML:'<svg class="b3-menu__icon " style=""><use xlink:href="#iconTable"></use></svg>',label:this.i18n.dTable,click:()=>{const e=t.blockElements[0],o=e.getAttribute("data-node-id");L(e,o,t.protyle,0)}})}switch_protyle(t){const e=t.detail.protyle.contentElement.querySelector(".protyle-title.protyle-wysiwyg--attr");if(!e)return;let o=e.getAttribute("niopStatu");if(o||(o="addToolBar",e.setAttribute("niopStatu",o)),o==="addToolBar"){const s=t.detail.protyle.contentElement;s.addEventListener("click",n=>{if(n.altKey){const i=n.composedPath();for(let l=0;l<i.length;l++){const r=i[l];if(typeof r.getAttribute=="function"&&r.getAttribute(V.ATTRNAME)!==null){const a=r,c=a.getAttribute("data-node-id");L(a,c,t.detail.protyle,0),n.preventDefault(),n.stopPropagation();break}if(r===s)break}}})}e.setAttribute("niopStatu","none")}};let k=V;k.OnRedner=!1,k.ATTRNAME="custom-nioptable";const Te=()=>{},L=(t,e,o,s=1e3)=>{const n=t,i=n.getAttribute("data-type");if(i!="NodeTable"&&i!="NodeHTMLBlock"){Y("\u53EA\u80FD\u4F7F\u7528\u5728Table\u4E0A",4e3);return}if(i==="NodeHTMLBlock"&&!n.getAttribute(k.ATTRNAME)){Y("\u6CA1\u6709\u539F\u59CB\u8868\u683C\u6570\u636E",4e3);return}const l=c=>{if(c.nodeID=e,c.tableNode=n,c.protyle=o,c.renderEditMethod===2||c.renderEditMethod<1){c.renderEditMethod=2;const p=[],u=c.tableNode.querySelector("colgroup");u&&u.querySelectorAll("col").forEach(g=>{const v=g.getBoundingClientRect().width,f=v?`${v}px`:"";p.push(f)}),c.colgroup=JSON.stringify(p),(0,A.fetchPost)("/api/block/getBlockKramdown",{id:c.nodeID},h=>R(void 0,null,function*(){c.renderEditMethod=2,c.setSourceTable(h.data.kramdown),yield X(e),j(c)}))}else j(c)},r=c=>{const p=n.getAttribute(k.ATTRNAME),u=new $(p);s>10?setTimeout(()=>{l(u)},s):l(u)},a=c=>{const p=new $(""),u={[k.ATTRNAME]:p.getJson()};s>10?setTimeout(()=>{x(e,u,()=>{l(p)})},s):x(e,u,()=>{l(p)})};fe(e,k.ATTRNAME,r,a)},_e=t=>{const e=t,o=e.getAttribute("data-node-id"),s=e.getAttribute(k.ATTRNAME);if(!o){console.error("error with data-node-id ");return}const n=e.getElementsByClassName("protyle-attr"),i=document.createElement("div");i.setAttribute("contenteditable","false"),i.classList.add("niop-toolbar-container"),i.addEventListener("mouseenter",()=>{i.classList.remove("hide"),i.classList.add("show")}),i.addEventListener("mouseleave",()=>{i.classList.remove("show"),i.classList.add("hide")}),n[0].appendChild(i);const l=new $(s);l.nodeID=o,l.tableNode=e;const r=document.createElement("button");r.textContent="Toolbar",r.setAttribute("niopButton","showMenu"),r.setAttribute("contenteditable","false"),r.classList.add("niop-button"),i.appendChild(r),r.addEventListener("click",()=>{j(l)});const a=document.createElement("button");a.textContent="Reload",a.setAttribute("niopButton","reload"),a.setAttribute("contenteditable","false"),a.classList.add("niop-button"),i.appendChild(a),a.addEventListener("click",()=>{be(l)}),l.toolBarMenuContainer=i},j=t=>{let e=!1;const o=d=>{e&&t.save(b=>{setTimeout(()=>{},200)})},s=new A.Dialog({title:`${k.Ini.i18n.OnEditSomthing_Table} : ${t.nodeID}`,content:`
      <div class="b3-dialog__content">
      <div class="fn__hr"></div>
      <div>${k.Ini.i18n.AVBlockID}:</div>
      <div class="fn__hr"></div>
      <input type="text" name="Dababase ID" id = "niopIDBox">
      <div class="fn__hr"></div>
      <div >${k.Ini.i18n.AVViewName}:</div>
      <div class="fn__hr"></div>
      <input type="text" name="Views Name" id = "niopIDBox2">
      <div class="fn__hr"></div>
      <div class="fn__hr"></div>
      <div>${k.Ini.i18n.RenderMethodAs}:</div>
      <div class="fn__hr"></div>
      <div class="renderMethod">
        <button class="niopRenderSelect" id = "niopRenderSelectCard" style="display: inline-block;" >${k.Ini.i18n.renderCard}</button>
        <button class="niopRenderSelect" id = "niopRenderSelectRight" style="display: inline-block;">${k.Ini.i18n.renderRight}</button>
        <button class="niopRenderSelect" id = "niopRenderSelectDown" style="display: inline-block;" >${k.Ini.i18n.renderBelow}</button>
      </div>
      <div class="fn__hr"></div>
      <div class="fn__hr"></div>
      <div>DisPlay as:</div>
      <div class="fn__hr"></div>
      <div class="niopRenderMethodDis">
      <div class="niopRenderSelect" id = "niopRenderAsEditor" aria-label="">${k.Ini.i18n.currentDisPlayMethod_Editor}</div>
      <div class="niopRenderSelect" id = "niopRenderAsDataBase" aria-label="">${k.Ini.i18n.currentDisPlayMethod_DateBase}</div>
      </div>
      <div class="fn__hr"></div>
      <div class="fn__hr"></div>
      <div>Switch Render:</div>
      <div class="fn__hr"></div>
      <div class="niopLoadMethod">
      <button class="niop-button" id = "niopEditTable" aria-label="">${k.Ini.i18n.currentDisPlayMethod_Editor}</button>
      <span style="width:120px;height:60px;"><span>
      <button class="niop-button" id = "niopReloadAll" aria-label="">${k.Ini.i18n.ReloadAll}</button>
      </div>
      <div class="fn__hr"></div>
      <div style="display:none">Edit</div>
      <div class="fn__hr"></div>

      <button class="niop-button hide" id = "niopSetFiltter" >SetFiltter</button>
      <button class="niop-button hide" id = "niopCleanFiltter" >cleanFiltter</button>
      <div class="fn__hr" style="display:none"></div>
      <div class="fn_none" style="display:none">json:</div>
      <div id = "jsonstring" class="fn_none" style="display:none"></div>
      </div>        
  `,width:"360px",height:"480px",destroyCallback:o}),n=s.element.querySelector("#jsonstring"),i=s.element.querySelector("#niopIDBox"),l=s.element.querySelector("#niopIDBox2"),r=s.element.querySelector("#niopRenderSelectCard"),a=s.element.querySelector("#niopRenderSelectRight"),c=s.element.querySelector("#niopRenderSelectDown"),p=s.element.querySelector("#niopEditTable"),u=s.element.querySelector("#niopReloadAll"),h=s.element.querySelector("#niopRenderAsEditor"),g=s.element.querySelector("#niopRenderAsDataBase"),v=s.element.querySelector("#niopSetFiltter"),f=s.element.querySelector("#niopCleanFiltter"),m=()=>{n.innerText=t.getJson()},E=()=>{r.classList.remove("select"),a.classList.remove("select"),c.classList.remove("select"),h.classList.remove("select"),g.classList.remove("select"),t.renderMethod===1?r.classList.add("select"):t.renderMethod===2?a.classList.add("select"):t.renderMethod===3&&c.classList.add("select"),t.renderEditMethod===1&&g.classList.add("select"),t.renderEditMethod===2&&h.classList.add("select")},D=()=>{const d=[{action:"setAttrViewFilters",avID:t.resourceAVID,data:t.hotReloadSetting.filters},{action:"setAttrViewSorts",avID:t.resourceAVID,data:t.hotReloadSetting.sorts}];t.protyle.getInstance().transaction(d)},_=()=>{t.renderEditMethod=2,h.classList.add("select"),g.classList.remove("select");const d=P(t.sourceTable,["fold","updated"]);G(t.nodeID,d,b=>{}),k.OnRedner=!1,e=!0,m()},w=d=>{t.resourceAVID!=""&&(h.classList.remove("select"),g.classList.add("select"),de(t,d))},I=()=>{q(t,d=>{if(!d){console.log("no av on the block:"+t.resourceID);return}e=!0,t.renderEditMethod=1,w(!1),m()})},S=()=>{const d=t.resourceAVID;q(t,b=>{if(!b){console.log("no av on the block"+t.resourceID);return}t.resourceAVID!=d?w(!1):w(!0),m()})};i.value=t.resourceID,l.value=t.resourceAVViewName,q(t,()=>{m()}),i.addEventListener("input",()=>{t.resourceID=i.value,e=!0}),l.addEventListener("input",()=>{t.resourceAVViewName=l.value,e=!0}),r.addEventListener("click",()=>{t.renderMethod=1,e=!0,m(),E()}),a.addEventListener("click",()=>{t.renderMethod=2,e=!0,m(),E()}),c.addEventListener("click",()=>{t.renderMethod=3,e=!0,m(),E()}),p.addEventListener("click",_),u.addEventListener("click",I),i.innerText=t.resourceID,E()},de=(t,e=!0)=>R(void 0,null,function*(){if(k.OnRedner){U(`${k.Ini.i18n.pleaseWaitOnRendering}`,3e3);return}k.OnRedner=!0,(0,A.fetchPost)("/api/av/renderAttributeView",{id:t.resourceAVID},o=>R(void 0,null,function*(){const s=o.data.view.rowCount,n=()=>{W&&(console.log("niopTable:"),console.log(t));const l=new pe(t.sourceTable,t);let r="";switch(t.renderMethod){case 1:l.direction={card:1,x:0,y:0},l.makeToCard(t),r=l.RebuildAsCard(t);break;case 2:l.direction={card:0,x:1,y:0},l.makeToCard(t),r=l.Rebuild(t);break;case 3:l.direction={card:0,x:0,y:1},l.makeToCard(t),r=l.Rebuild(t);break;default:U(`${k.Ini.i18n.mustSelectOneRenderMethod}`,5e3);break}W&&(console.log("\u9884\u5904\u7406\u8868\u683C"),console.log(l),console.log(r)),G(t.nodeID,r),t.renderEditMethod=1,k.OnRedner=!1};e=!1;let i=o.data.view.id;if(t.resourceAVViewName!=""&&o.data.view.name!=t.resourceAVViewName&&o.data.views.length>1){for(let l=0;l<o.data.views.length;l++){const r=o.data.views[l];if(r.name===t.resourceAVViewName){e=!0,i=r.id;break}}e||console.log("error view name")}e||s>o.data.view.rows.length?(0,A.fetchPost)("/api/av/renderAttributeView",{id:t.resourceAVID,viewID:i,pageSize:s},r=>{t.titles=t.deepCopy(r.data.view.columns),t.rows=r.data.view.rows,t.avTable=r,n()}):(t.titles=t.deepCopy(o.data.view.columns),t.rows=o.data.view.rows,t.avTable=o,n())}))}),Ce=(t,e=null)=>{fetchPost("/api/av/renderAttributeView",{id:t.resourceAVID},o=>{t.titles=t.deepCopy(o.data.view.columns),t.rows=o.data.view.rows,t.avTable=o,t.setting.filters=Object.assign(o.data.view.filters),t.setting.sorts=Object.assign(o.data.view.sorts),e&&e()})},Re=t=>{console.log(t)};class ${constructor(e){this.renderMethod=-1,this.renderEditMethod=2,this.resourceID="",this.resourceAVID="",this.resourceAVViewName="",this.setting={filters:[],sorts:[]},this.hotReloadSetting={filters:[],sorts:[]},this.titles=[{id:"",name:"",type:"",icon:"",wrap:!1,hidden:!1,pin:!1,width:"68px",numberFormat:"",template:""}],this.sourceTable="",this.colgroup="",this.nodeID="";try{const o=JSON.parse(e);this.renderMethod=o.renderMethod||this.renderMethod,this.resourceID=o.resourceID||this.resourceID,this.resourceAVID=o.resourceAVID||this.resourceAVID,this.sourceTable=this.decode(o.sourceTable)||this.sourceTable,this.renderEditMethod=o.renderEditMethod||this.renderEditMethod,this.hotReloadSetting=o.hotReloadSetting||this.hotReloadSetting,this.colgroup=this.decode(o.colgroup)||this.colgroup,this.resourceAVViewName=o.resourceAVViewName||this.resourceAVViewName}catch(o){console.log("Error parsing JSON:",o),this.save(s=>{setTimeout(()=>{},200)})}}clean(){this.protyle=null}getJson(){return JSON.stringify({renderMethod:this.renderMethod,resourceID:this.resourceID,resourceAVID:this.resourceAVID,sourceTable:this.encode(this.sourceTable),renderEditMethod:this.renderEditMethod,hotReloadSetting:this.hotReloadSetting,colgroup:this.encode(this.colgroup),resourceAVViewName:this.resourceAVViewName})}encode(e){const o=encodeURIComponent(e);return window.btoa(o)}decode(e){try{const o=atob(e);return decodeURIComponent(o)}catch(o){return console.error("Error decoding string:",o),""}}deepCopy(e){return JSON.parse(JSON.stringify(e))}setSourceTable(e){const o=/custom-nioptable="[^"]*"/g,s=e.replace(o,"");this.sourceTable=s}save(e=null){if(this.nodeID!=""){const o={[k.ATTRNAME]:this.getJson()};e?x(this.nodeID,o,s=>{e(s)}):x(this.nodeID,o)}}}const Ne=()=>{const t=`|{: colspan="4" rowspan="1"}\u6807\u9898|{: colspan="1" class="fn__none"}|{: colspan="1" class="fn__none"}|{: colspan="1" class="fn__none"}|
| :-------------------------------: | :--------------------------------: | :--------------------------------: | :--------------------------------: |
|{: colspan="1"}\u5934\u50CF|{: colspan="1"}\u540D\u5B57|{: colspan="1"}\u7B49\u7EA7|\u6280\u80FD|
|..(icon)|..(name)|..(level)|..(skill)|
{: colgroup="width: 94px;|width: 121px;|width: 95px;|width: 116px;" custom-nioptable="123" fold="0" id="20231120114455-g1jmigv" updated="20231130193916"}`,o=t.split(`
`).slice(0,-1).map(n=>n.split(new RegExp("(?<!\\\\)\\|")).map(i=>i.replace(/\\\|/g,"|"))),s=[[{content:"",config:""}]];o.forEach((n,i)=>{s[i]=[],n.forEach((l,r)=>{s[i][r]=z(l)}),s[i]=s[i].slice(1,-1)}),console.log(t),console.log(s)},ue=/{:\s*(.+?)\s*}/,z=t=>{const e=t.match(ue);if(e){const o=t.replace(e[0],""),s=he(e[1]),n=s.attributes,i=!!(n.colspan&&n.colspan>1||n.rowspan&&n.rowspan>1);return{content:o,config:n,configNo:s.length,resize:i,valueType:"",colspan:n.colspan?parseInt(n.colspan):1,rowspan:n.rowspan?parseInt(n.rowspan):1}}else return{content:t,config:{},configNo:0,resize:!1,valueType:"",colspan:1,rowspan:1}};function he(t){const e=/(\S+)=["']([^"']+)["']/g,o=t.match(e);if(!o)return{};const s={};let n=0;return o.forEach(i=>{const[l,r,a]=i.match(/(\S+)=["']([^"']+)["']/);s[r]=a,n++}),{attributes:s,length:n}}class pe{constructor(e,o){this.cells=[],this.dashRowNum=1,this.colgroup=[],this.rowsStyleStrs=[],this.end="",this.cards=[],this.haveActionValueRegex=/\.\.\((.+?)\)/g,this.checkifHaveActionValue=s=>!!s.content.match(this.haveActionValueRegex),this.direction={card:0,x:0,y:0},this.curCell={card:0,x:0,y:0},this.parseTable(e,o)}parseTable(e,o){const s={};let n=!1;const i=e.split(`
`);this.end=i[i.length-1],i.slice(0,-1).map(r=>r.split(new RegExp("(?<!\\\\)\\|")).map(a=>a.replace(/\\\|/g,"|"))).forEach((r,a)=>{this.cells[a]=[];let c=!1;s[a]||(s[a]=0),r.forEach((p,u)=>{if(this.cells[a][u]=z(p),!n&&this.cells[a][u].rowspan>1){c=!0;for(let h=0;h<this.cells[a][u].rowspan;h++)s[a+h]?s[a+h]+=1:s[a+h]=1}}),!n&&!c&&s[a]===0&&(n=!0,this.dashRowNum<a&&(this.dashRowNum=a)),this.cells[a]=this.cells[a].slice(1,-1)}),this.getRawColgroup(o),this.getMdSettingFromTable()}removeEmpetyInputRows(e){const o=e.avTable.data.view;let s=-1;for(let i=0;i<o.columns.length;i++)if(o.columns[i].type==="block"){s=i;break}const n=[];for(let i=0;i<o.rows.length;i++)o.rows[i].cells[s].value.block.content===""&&n.push(i);for(let i=n.length-1;i>=0;i--)o.rows.splice(n[i],1)}caculateColAndRowGroup(e){this.cells.forEach((o,s)=>{o.forEach((n,i)=>{switch(e.renderMethod){case 1:break;case 2:n.colspan>1&&o.length==i+n.colspan?(n.colspan+=e.rows.length-1,n.config.colspan=n.colspan):o.length==1&&n.colspan==1&&this.dashRowNum!=s&&(this.checkifHaveActionValue(n)||(n.colspan+=e.rows.length-1,n.config.colspan=n.colspan,n.configNo+=1));break;case 3:n.rowspan>1&&this.cells.length==s+n.rowspan+1?(n.rowspan+=e.rows.length,n.config.rowspan=n.rowspan):this.cells.length==2&&n.rowspan==1&&this.dashRowNum!=s&&(this.checkifHaveActionValue(n)||(n.rowspan+=e.rows.length-1,n.config.rowspan=n.rowspan,n.configNo+=1));break;default:break}})})}Rebuild(e){const o=this.cards.map(i=>i.map(l=>"|"+l.map(r=>{let a="";return r.configNo>0&&(a="{: "+Object.entries(r.config).map(([c,p])=>`${c}="${p}"`).join("  ")+"}"),a+r.content}).join("|")).join(`|
`)).join("");this.end=e.renderMethod===2?P(this.end,["fold","id","updated","colgroup"]):P(this.end,["fold","id","updated"]);let s=' id="'+e.nodeID+'" ';e.renderMethod===2&&(s+=' colgroup="'+this.colgroup.map(i=>"width: "+i+";").join("|")+'" ');const n=this.end;return this.end=n.slice(0,2)+s+n.slice(2),`${o}
${this.end}`}RebuildAsCard(e){const o=P(this.end,["fold","id","updated","colgroup"]),s=` id="${e.nodeID}"  data-type="NodeHTMLBlock" `;this.end=o.slice(0,2)+s+o.slice(2);const n=ge(this.cards.length,this.cells.length-1,this.colgroup,this.rowsStyleStrs,e),i=[];return this.cards.forEach((l,r)=>{l.forEach((a,c)=>{if(this.dashRowNum!=c){const p=c>this.dashRowNum?c-1:c;a.forEach((u,h)=>{const g=n.cells[r][p][h];if(g.innerHTML=u.content,u.configNo>0){if(u.colspan>1||u.rowspan>1)for(let v=0;v<u.colspan;v++)for(let f=0;f<u.rowspan;f++)v===0&&f===0||i.push(n.cells[r][p+f][h+v]);if(u.colspan>1){g.setAttribute("colspan",`${u.colspan}`);let v=parseInt(g.style.width);for(let f=1;f<u.colspan;f++)v+=parseInt(n.cells[r][p][h+f].style.width);g.style.width=v+"px"}u.rowspan>1&&g.setAttribute("rowspan",`${u.rowspan}`)}})}}),i.forEach(a=>{a.className="fn__none"})}),`<div>${n.body.innerHTML}</div>
${this.end}`}makeToCard(e){this.cards=[],this.removeEmpetyInputRows(e),this.caculateColAndRowGroup(e);const o=this.cells[0].length,s=this.cells.length,n=e.titles.length,i=e.rows.length,l=this.cards,r={card:0,x:0,y:0},a=this.direction;if(a.card==1?(ve(this.cells),e.rows.forEach((h,g)=>{l[g]=e.deepCopy(this.cells)})):l[0]=e.deepCopy(this.cells),a.x===1){const h=l[0],g=this.colgroup[this.colgroup.length-1];for(let v=0;v<e.rows.length-1;v++)this.colgroup.push(g);for(let v=0;v<s;v++){const f=JSON.parse(JSON.stringify(h[v][o-1]));f.colspan>1&&this.dashRowNum!=v&&(f.content="",f.config.class="fn__none",f.colspan=1,f.config.colspan=1,f.configNo=1);const m=JSON.stringify(f);e.rows.forEach((E,D)=>{D!=0&&h[v].push(JSON.parse(m))})}}if(a.y===1){const h=l[0],g=e.rows.length,v=h[0].length,f=this.dashRowNum===s-1;let m;f?m=JSON.parse(JSON.stringify(Object.assign(h[s-2]))):m=Object.assign(JSON.parse(JSON.stringify(h[s-1]))),m.forEach(D=>{D.rowspan>1&&(D.content="",D.config.class="fn__none",D.rowspan=1,D.config.rowspan=1,D.configNo=1)});const E=JSON.stringify(m);for(let D=1;D<g;D++)f?h.splice(h.length-1,0,JSON.parse(E)):h.push(JSON.parse(E))}const c=[],p=/\.\.\((.*?)\)/;this.cells.forEach((h,g)=>{h.forEach((v,f)=>{v.content.match(p)&&c.push({x:g,y:f})})}),e.titles.forEach((h,g)=>{if(h.name!=""){const v=`..(${h.name})`;c.forEach(f=>{const m=this.cells[f.x][f.y];if(new RegExp(v).test(m.content))for(let D=0;D<i;D++){const _=this.getOffsetCell(f,D),w=e.rows[D].cells[g];let I="[None Data]",S=w.value[w.valueType];switch(w.valueType){case"block":I=w.value.block.content;break;case"number":I=w.value.number.content;break;case"phone":I=w.value.phone.content;break;case"mAsset":if(w.value.mAsset&&(e.renderMethod===1?I=`<span class='imgDiv'><img src="${w.value.mAsset[0].content}"></span>`:I=`![image](${w.value.mAsset[0].content})`),w.value.mAsset){const d=w.value.mAsset.length;e.renderMethod===1?d===1?I=`<span class='imgDiv'><img src="${w.value.mAsset[0].content}"></span>`:I=`<span class='AssetContainer'>${w.value.mAsset.map(y=>y.type==="image"?`<span class='imgDiv'><img src='${y.content}' alt='${y.name}'></span>`:`<span class='fileDiv'><a href='${y.content}' title='${y.name}'>${y.name}</a></span>`).join("")}</span>`:d===1?I=w.value.mAsset[0].type==="image"?`![image](${w.value.mAsset[0].content})`:`![file](${w.value.mAsset[0].content})`:I=`${w.value.mAsset.map(y=>y.type==="image"?`![${y.name}](${y.content})`:`[${y.name}](${y.content})`).join("")}`}else I="[No Assets]";break;case"select":S=w.value.mSelect,S&&(I=S.length>0?S[0].content:"None Select");break;case"mSelect":S=w.value.mSelect,S&&(I=S.length>0?S.map(d=>d.content).join(","):"None Select");break;default:S.content&&(I=S.content);break}_.content=_.content.replace(v,I)}})}})}getOffsetCell(e,o){let s=0,n=e.x,i=e.y;return this.direction.card===1&&(s=o),this.direction.y===1&&(n+=o),this.direction.x===1&&(i+=o),this.cards[s][n][i]}getRawColgroup(e){this.colgroup=JSON.parse(e.colgroup)}getMdSettingFromTable(){const e=[];this.cells.forEach((o,s)=>{if(s!=this.dashRowNum){const n=o[0].content,i=/\.\.style\(([^)]*)\)/,l=n.match(i);if(l&&l[1]){const r=l[1];let a=l[1];a.length>1&&a.charAt(a.length-1)!==";"&&(a=a+";"),e.push(a),o[0].content=n.replace(l[0],"")}else e.push("")}}),this.rowsStyleStrs=e}}const q=(t,e=null)=>{(0,A.fetchPost)("/api/block/getBlockKramdown",{id:t.resourceID},o=>{const s=o.data.kramdown,n=/data-av-id="([^"]+)"/,i=s.match(n);if(i)t.resourceAVID!=i[1]&&(t.resourceAVID=i[1]);else{console.log("No av-id"),t.resourceAVID="",e&&e(!1);return}e&&e(!0)})},Me=(t,e=null)=>{fetchPost("/api/block/getBlockKramdown",{id:t.resourceID},o=>{const s=o.data.kramdown,n=/data-av-id="([^"]+)"/,i=s.match(n);if(i)t.resourceAVID!=i[1]&&(t.resourceAVID=i[1]);else{console.log("No av-id"),t.resourceAVID="",e&&e(!1);return}e&&e(!0)})},Ve=t=>{};function x(t,e,o=null){const s=JSON.stringify({id:t,attrs:e});(0,A.fetchPost)("/api/attr/setBlockAttrs",{id:t,attrs:e},n=>{o&&o(n)})}function fe(t,e,o=null,s=null){const n={id:t};return(0,A.fetchPost)("/api/attr/getBlockAttrs",n,i=>{i.data[e]?o&&o(i.data[e]):s&&s(i)}),!1}function xe(t,e){return R(this,null,function*(){const o={id:t};return fetchPost("/api/attr/getBlockAttrs",o,s=>{const n=s.data[e];return n||null}),null})}function Be(t,e=null){fetchPost("/api/av/renderAttributeView",{id:t},o=>{e&&e(o)})}function G(t,e,o=null){(0,A.fetchPost)("/api/block/updateBlock",{dataType:"markdown",data:e,id:t},s=>{o&&o(s)})}function U(t,e,o=null){(0,A.fetchPost)("/api/notification/pushMsg",{msg:t,data:e},s=>{o&&o(s)})}function Y(t,e,o=null){(0,A.fetchPost)("/api/notification/pushErrMsg",{msg:t,data:e},s=>{o&&o(s)})}const X=(t,e=30)=>R(void 0,null,function*(){const o="custom-nioptablewait";let n=0,i=!0;const l=()=>{n++>e&&(i=!1,n=0)};for(x(t,{[o]:"1"},r=>{i=!1});i;)yield new Promise(r=>setTimeout(r,50)),l();for(i=!0,x(t,{[o]:""},r=>{i=!1});i;)yield new Promise(r=>setTimeout(r,50)),l()}),P=(t,e)=>{const o=e.map(i=>`${i}="[^"]*"`).join("|"),s=new RegExp(o,"g");return t.replace(s,"")};function ge(t,e,o,s,n){const i=document.createElement("div"),l=document.createElement("style"),r=me();l.textContent=`
.niop-card {
  padding: 5px;
  margin: 5px;
  display: inline-block;
  background-color: ${r.surfaceLight}; 
  border-radius: 5px; 
  opacity: 0.95;
  transition: box-shadow 0.3s ease; 
}
.niop-card:hover {
  box-shadow: 0 0 10px rgba(0, 0, 0, 1.0); 
  background-color: ${r.primarylight}; 
  opacity: 1;
}
.niop-card tr{
  background-color:${r.surface};
  /* height of each line */
  min-height: auto;
}
.niop-card tr.thread{
  background-color:${r.surface};
}
.niop-card img {
  line-height: 0;
  object-fit: contain;
  width: 100%;
  height: 100%;
  vertical-align: middle;
}
.niop-card td {
  border-Color:${r.cellBorderColor};
  border-collapse: collapse;
  text-align: center;
  overflow-wrap: anywhere;
}
.niop-card td:hover {
  box-shadow: 0px 0px 30px ${r.primarylighter};
}
.niop-card span.imgsDiv {
  width: 0;
  height: -webkit-fill-available;
  display: flex;
}
.niop-card span.imgDiv  {
  height: -webkit-fill-available;
  width: -webkit-fill-available;
}
.AssetContainer {
  position: relative;
  height: 100%;
  width: 100%;
  display: block;
  overflow-x: auto;
  white-space: nowrap;
  left: 0px;
  top: 14px;
}
.AssetContainer::-webkit-scrollbar {
height: 5px; 
background-color: transparent; 
}
.AssetContainer::-webkit-scrollbar-track {
background-color: transparent;
}
.AssetContainer::-webkit-scrollbar-thumb {
background-color: rgba(0, 0, 0, 0.098); 
transition: background-color 0.3s ease; 
}
.AssetContainer:hover::-webkit-scrollbar-thumb {
background-color: rgba(0, 0, 0, 0.6); 
height: 20px; 
}
.fn__none {
  display: none !important;
}
`,i.append(l);const a=document.createElement("div");a.className="cardContainer",i.append(a);const c=[];for(let p=0;p<t;p++){const u=document.createElement("div");u.className="niop-card";const h=document.createElement("table");for(let g=0;g<e;g++){const v=document.createElement("tr");if(s[g]!=""){const f=s[g];v.setAttribute("style",f)}g===0&&(v.className="thread");for(let f=0;f<o.length;f++){const m=document.createElement("td");m.style.width=o[f],m.style.height="inherit",c[p]||(c[p]=[]),c[p][g]||(c[p][g]=[]),c[p][g][f]=m,v.appendChild(m)}h.appendChild(v)}u.appendChild(h),a.appendChild(u)}return{body:i,cells:c}}function me(){const t=window.getComputedStyle(document.documentElement);return{backgroundColor:t.getPropertyValue("--b3-theme-background"),surface:t.getPropertyValue("--b3-theme-surface"),surfaceLight:t.getPropertyValue("--b3-theme-surface-lighter"),cellBorderColor:t.getPropertyValue("--b3-border-color"),primarylight:t.getPropertyValue("--b3-theme-primary-light"),primarylighter:t.getPropertyValue("--b3-theme-primary-lighter"),primarylightest:t.getPropertyValue("--b3-theme-primary-lightest"),listhover:t.getPropertyValue("--b3-list-hover"),tooltipscolor:t.getPropertyValue("--b3-tooltips-color"),tooltipsbackground:t.getPropertyValue("--b3-tooltips-background")}}function $e(t){const e={backgroundColor:"",surface:"",surfaceLight:"",cellBorderColor:""},o=t.querySelector("thead");if(o){const i=window.getComputedStyle(o);e.surface=i.backgroundColor}const s=t.querySelector("tbody");if(s){const i=window.getComputedStyle(s);e.surfaceLight=i.backgroundColor}const n=t.querySelectorAll("td");if(n.length>0){const i=window.getComputedStyle(n[0]);e.cellBorderColor=i.borderColor}return e}function ve(t){const e=/\[([^\]]*)\]\(([^)]+)\)/g;t.forEach(o=>{o.forEach(s=>{let n;for(;(n=e.exec(s.content))!==null;){const i=n[0],l=n[1],r=n[2],a=s.content[n.index-1]==="!",c=a?`<img style="max-width:px;" src="${r}" alt="${l}">`:`<a href="${r}">${l}</a>`;s.content=s.content.replace(a?"!"+i:i,c)}})})}const be=t=>{throw new Error("Function not implemented.")};module.exports=O})();
